---
description: API documentation standards - API doc structure, function documentation, parameter descriptions
globs: docs/api/**/*.md
alwaysApply: false
---

# API Documentation Standards

## Purpose
Define standards for API documentation in `docs/api/`, including structure, function/method documentation, parameter descriptions, and return value documentation.

## API Document Structure

### Complete API Document
Each API document must follow standard structure.

```markdown
# ✅ GOOD - Complete API document
# Backtest API

Module for executing Zipline backtests and saving results.

**Location:** `lib/backtest.py`
**CLI Equivalent:** `scripts/run_backtest.py`

---

## run_backtest()

Execute a Zipline backtest for a strategy.

**Signature:**
```python
def run_backtest(
    strategy_name: str,
    start_date: Optional[str] = None,
    end_date: Optional[str] = None,
    capital_base: Optional[float] = None
) -> Tuple[pd.DataFrame, Any]
```

**Parameters:**
- `strategy_name` (str): Name of strategy
- `start_date` (str, optional): Start date YYYY-MM-DD
- `end_date` (str, optional): End date YYYY-MM-DD
- `capital_base` (float, optional): Starting capital

**Returns:**
- `Tuple[pd.DataFrame, Any]`: (Performance DataFrame, trading calendar)

**Raises:**
- `FileNotFoundError`: If strategy not found
- `ValueError`: If dates invalid

**Example:**
```python
from lib.backtest import run_backtest
perf, calendar = run_backtest('btc_sma_cross')
```

**See Also:**
- [Backtest Patterns](lib-backtest.mdc)
- [Strategy Development](strategies.mdc)

# ❌ BAD - Incomplete API doc
# run_backtest()
Runs a backtest.
# Missing signature, parameters, examples!
```

## Function Documentation

### Complete Function Documentation
Each function must have complete documentation.

```markdown
# ✅ GOOD - Complete function documentation
## `calculate_metrics(returns, transactions=None, benchmark_returns=None)`

Calculate comprehensive performance metrics from returns.

**Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `returns` | pd.Series | required | Daily returns series |
| `transactions` | pd.DataFrame | None | Transactions for trade metrics |
| `benchmark_returns` | pd.Series | None | Benchmark for alpha/beta |

**Returns:**
- `Dict[str, float]`: Dictionary of calculated metrics

**Raises:**
- `ValueError`: If returns is not a valid Series

**Example:**
```python
from lib.metrics import calculate_metrics
metrics = calculate_metrics(returns, transactions=transactions_df)
print(f"Sharpe: {metrics['sharpe_ratio']:.2f}")
```

# ❌ BAD - Incomplete function doc
## calculate_metrics()
Calculates metrics.
# Missing parameters, returns, examples!
```

## Parameter Documentation

### Detailed Parameter Descriptions
All parameters must be documented with type, default, and description.

```markdown
# ✅ GOOD - Detailed parameters
**Parameters:**
| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `strategy_name` | str | required | Strategy name (e.g., 'btc_sma_cross') |
| `start_date` | str | None | Start date in 'YYYY-MM-DD' format |
| `end_date` | str | None | End date in 'YYYY-MM-DD' format |
| `capital_base` | float | None | Initial capital (uses config default if None) |

# ❌ BAD - Missing parameter details
**Parameters:**
- strategy_name: Strategy name
- start_date: Start date
# Missing types, defaults, formats!
```

## Return Value Documentation

### Complete Return Documentation
Return values must be fully documented.

```markdown
# ✅ GOOD - Complete return documentation
**Returns:**
- `pd.DataFrame`: Performance DataFrame with columns:
  - `returns`: Daily/minute returns
  - `portfolio_value`: Total portfolio value
  - `positions`: Position values
  - `cash`: Cash on hand
- `Any`: Trading calendar object

**Return Example:**
```python
perf, calendar = run_backtest('btc_sma_cross')
returns = perf['returns']
portfolio_value = perf['portfolio_value']
```

# ❌ BAD - Vague return documentation
**Returns:**
- DataFrame with results
# Missing structure, column descriptions!
```

## Exception Documentation

### Document All Exceptions
All possible exceptions must be documented.

```markdown
# ✅ GOOD - Complete exception documentation
**Raises:**
- `FileNotFoundError`: If strategy file not found
- `ImportError`: If strategy module can't be loaded
- `ValueError`: If dates invalid or parameters missing
- `RuntimeError`: If backtest execution fails

# ❌ BAD - Missing exceptions
**Raises:**
- Error if something goes wrong
# Too vague, missing specific exceptions!
```

## Example Usage

### Complete Working Examples
All examples must be complete and working.

```markdown
# ✅ GOOD - Complete working example
**Example:**
```python
from lib.backtest import run_backtest, save_results
from lib.config.strategy import load_strategy_params

# Run backtest
perf, calendar = run_backtest(
    strategy_name='btc_sma_cross',
    start_date='2023-01-01',
    end_date='2024-01-01',
    capital_base=100000
)

# Save results
params = load_strategy_params('btc_sma_cross')
result_dir = save_results(
    strategy_name='btc_sma_cross',
    perf=perf,
    params=params,
    trading_calendar=calendar
)
```

# ❌ BAD - Incomplete example
**Example:**
```python
run_backtest('btc_sma_cross')
# Missing imports, incomplete usage!
```

## Cross-References

### Include See Also Section
Include cross-references to related documentation.

```markdown
# ✅ GOOD - Cross-references
**See Also:**
- [Backtest Patterns](lib-backtest.mdc)
- [Strategy Development](strategies.mdc)
- [Metrics Calculation](lib-metrics.mdc)
- [CLI: run_backtest.py](../scripts/run_backtest.py)

# ❌ BAD - Missing cross-references
# No See Also section!
```

## Enforcement

- **Structure Check**: Verify API documents follow standard structure
- **Parameter Completeness**: Check all parameters documented
- **Return Documentation**: Verify return values fully described
- **Example Validity**: Ensure examples are complete and working

## Related Agents

- `.claude/agents/report-generator.md` - API documentation
- `.claude/agents/maintainer.md` - Documentation maintenance
- `docs/api/` - API documentation directory
