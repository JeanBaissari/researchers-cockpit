---
description: Code pattern documentation - pattern structure, example standards, cross-references, categorization
globs: docs/code_patterns/**/*.md
alwaysApply: false
---

# Code Pattern Documentation Patterns

## Purpose
Define patterns for documenting code patterns in `docs/code_patterns/`, including structure standards, example code standards, cross-references, and pattern categorization.

## Pattern Documentation Structure

### Complete Pattern Documentation
Each pattern document must follow standard structure.

```markdown
# ✅ GOOD - Complete pattern documentation
# Pattern: UTC Timezone Normalization

## Purpose
Normalize all datetime operations to UTC for consistency across the system.

## Pattern
```python
from lib.data.normalization import normalize_to_utc
df.index = df.index.map(normalize_to_utc)
```

## When to Use
- Loading CSV data
- Processing time series data
- Before Zipline backtest execution
- When combining data from multiple sources

## Examples

### Example 1: Normalize DataFrame Index
```python
df.index = pd.to_datetime(df.index)
df.index = df.index.map(normalize_to_utc)
```

### Example 2: Normalize Single Timestamp
```python
timestamp = normalize_to_utc('2024-01-01 10:00:00')
```

## See Also
- [Data Normalization](lib-data.mdc)
- [Bundle Ingestion](lib-bundles.mdc)

# ❌ BAD - Incomplete pattern docs
# UTC Normalization
Use normalize_to_utc().
# Missing purpose, examples, when to use!
```

## Pattern Categorization

### Organize by Category
Patterns organized in `docs/code_patterns/` by category.

```markdown
# ✅ GOOD - Organized by category
docs/code_patterns/
├── 00_getting_started/     # Getting started patterns
├── 01_core/                # Core API patterns
├── 02_data/                # Data access patterns
├── 03_scheduling/          # Scheduling patterns
├── 04_orders/              # Order management patterns
├── 05_assets/               # Asset patterns
├── 06_pipeline/            # Pipeline API patterns
├── 07_finance/             # Finance patterns
├── 08_data_bundles/        # Bundle patterns
├── 09_metrics/              # Metrics patterns
├── 10_utilities/            # Utility patterns
└── 11_reference/            # Reference patterns

# ❌ BAD - Flat organization
docs/code_patterns/
├── pattern1.md
├── pattern2.md
# No organization!
```

## Example Code Standards

### Complete Working Examples
All examples must be complete and working.

```markdown
# ✅ GOOD - Complete working example
## Example: Bundle Ingestion

```python
from lib.bundles import ingest_bundle

# Ingest crypto data
bundle_name = ingest_bundle(
    source='yahoo',
    assets=['crypto'],
    symbols=['BTC-USD', 'ETH-USD'],
    timeframe='daily',
    start_date='2020-01-01',
    end_date='2024-01-01'
)

print(f"Bundle created: {bundle_name}")
```

# ❌ BAD - Incomplete example
## Example
```python
ingest_bundle(...)
# Missing imports, incomplete parameters!
```

## Cross-References

### Use Standard Cross-Reference Format
Include "See Also" section with cross-references.

```markdown
# ✅ GOOD - Standard cross-references
## See Also
- [Bundle Management](lib-bundles.mdc)
- [Data Validation](lib-validation.mdc)
- [API Reference: Bundles](../api/bundles.md)

# ❌ BAD - Missing or broken links
## See Also
- bundles.md  # Relative path may break!
```

## Pattern Purpose Section

### Clear Purpose Statement
Each pattern must have clear purpose section.

```markdown
# ✅ GOOD - Clear purpose
## Purpose
Normalize all datetime operations to UTC for consistency.
This ensures timezone-aware data works correctly across
different systems and prevents timezone-related bugs.

# ❌ BAD - Vague purpose
## Purpose
Normalize timestamps.
# Too brief, missing context!
```

## When to Use Section

### Specific Use Cases
List specific scenarios when pattern should be used.

```markdown
# ✅ GOOD - Specific use cases
## When to Use
- Loading CSV data with timestamps
- Processing time series data from APIs
- Before Zipline backtest execution
- When combining data from multiple timezones

# ❌ BAD - Generic use cases
## When to Use
- When working with dates
# Too generic!
```

## Enforcement

- **Structure Check**: Verify pattern follows standard structure
- **Example Completeness**: Check examples are complete and working
- **Cross-References**: Verify links are valid and follow conventions
- **Categorization**: Ensure patterns in correct category directories

## Related Agents

- `.claude/agents/pattern-applier.md` - Pattern application
- `.claude/agents/maintainer.md` - Documentation maintenance
- `docs/code_patterns/` - Pattern documentation directory
