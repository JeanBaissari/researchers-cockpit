---
description: Strategy development patterns - strategy file structure, parameter externalization, hypothesis documentation
globs: strategies/**/*.py,strategies/**/*.md,strategies/**/*.yaml
alwaysApply: false
---

# Strategy Development Patterns

## Purpose
Define patterns for strategy development in `strategies/`, including file structure, parameter externalization, hypothesis documentation, and strategy template usage.

## Strategy File Structure

### Required Files
Each strategy must have complete file structure.

```
# ✅ GOOD - Complete strategy structure
strategies/{asset_class}/{strategy_name}/
├── strategy.py          # REQUIRED: Strategy implementation
├── hypothesis.md        # REQUIRED: Hypothesis documentation
└── parameters.yaml      # REQUIRED: Strategy parameters

# ❌ BAD - Missing required files
strategies/crypto/btc_sma_cross/
└── strategy.py  # Missing hypothesis.md and parameters.yaml!
```

### Strategy File Organization

```python
# ✅ GOOD - Use template structure
# strategies/_template/strategy.py
from zipline.api import order, symbol, schedule_function
from lib.config.strategy import load_strategy_params

def initialize(context):
    params = load_strategy_params('btc_sma_cross')
    context.asset = symbol(params['parameters']['symbol'])
    # ... strategy setup

# ❌ BAD - Hardcoded parameters
def initialize(context):
    context.asset = symbol('BTC-USD')  # Should load from parameters.yaml!
    context.fast_period = 10  # Should load from parameters.yaml!
```

## Parameter Externalization

### No Hardcoded Parameters
All tunable parameters must be in `parameters.yaml`.

```python
# ✅ GOOD - Load parameters from YAML
from lib.config.strategy import load_strategy_params

def initialize(context):
    params = load_strategy_params('btc_sma_cross')
    
    # Access parameters
    symbol = params['parameters']['symbol']
    fast_period = params['parameters']['fast_period']
    slow_period = params['parameters']['slow_period']
    
    context.asset = symbol(symbol)
    context.fast_period = fast_period
    context.slow_period = slow_period

# ❌ BAD - Hardcoded parameters
def initialize(context):
    context.asset = symbol('BTC-USD')  # Hardcoded!
    context.fast_period = 10  # Hardcoded!
    context.slow_period = 50  # Hardcoded!
```

### Parameters YAML Structure

```yaml
# ✅ GOOD - Complete parameters.yaml structure
strategy:
  name: btc_sma_cross
  asset_class: crypto
  
parameters:
  symbol: BTC-USD
  fast_period: 10
  slow_period: 50
  threshold: 0.02
  
backtest:
  start_date: "2023-01-01"
  end_date: "2024-06-01"
  capital: 100000

# ❌ BAD - Flat or missing structure
symbol: BTC-USD
fast_period: 10
slow_period: 50
# No organization, missing strategy metadata!
```

## Hypothesis Documentation

### Complete Hypothesis Documentation
Each strategy must have `hypothesis.md` with structured content.

```markdown
# ✅ GOOD - Complete hypothesis.md
# Hypothesis: BTC SMA Cross Strategy

## The Hypothesis
BTC trends persist for more than 20 days on average.
A simple moving average crossover can capture these trends.

## The Reasoning
- Crypto markets show strong momentum characteristics
- Retail FOMO creates sustained trends
- SMA crossovers are simple and robust

## The Conditions
- Works in trending markets
- Fails in choppy, sideways conditions
- Requires sufficient volatility

## The Falsification
If Sharpe < 0.5 across 3+ years of data, the edge doesn't exist.

# ❌ BAD - Incomplete hypothesis
# BTC Strategy
Buy when price crosses above SMA.
# Missing reasoning, conditions, falsification!
```

## Strategy Template Usage

### Use Template for New Strategies
Always start new strategies from `strategies/_template/`.

```bash
# ✅ GOOD - Copy template
cp -r strategies/_template/ strategies/crypto/btc_sma_cross/
cd strategies/crypto/btc_sma_cross/
# Edit strategy.py, hypothesis.md, parameters.yaml

# ❌ BAD - Create from scratch
# Don't create strategy files manually!
```

### Template Structure

```python
# ✅ GOOD - Follow template structure
# Template provides:
# - Standard imports
# - initialize() skeleton with parameter loading
# - handle_data() with common patterns
# - analyze() with standard metrics
# - Logging hooks

# ❌ BAD - Ignore template
# Creating strategy without using template
# Missing standard structure and patterns!
```

## Strategy Implementation

### Use Standard Strategy Functions
Follow Zipline strategy function conventions.

```python
# ✅ GOOD - Standard strategy functions
def initialize(context):
    """Called once at start. Set up state here."""
    params = load_strategy_params('btc_sma_cross')
    # ... setup

def before_trading_start(context, data):
    """Called once per day before market open."""
    # ... pre-trading logic

def handle_data(context, data):
    """Called every bar (minute/daily)."""
    # ... trading logic

def analyze(context, perf):
    """Called once at end with performance DataFrame."""
    # ... analysis

# ❌ BAD - Non-standard functions
def my_custom_function(context, data):
    # Don't create non-standard functions!
    pass
```

## Strategy Naming Conventions

### Follow Naming Conventions
Strategy names must follow conventions.

```python
# ✅ GOOD - Standard naming
strategies/crypto/btc_sma_cross/      # lowercase, underscores
strategies/forex/eurusd_breakout/     # asset_pair_strategy_type
strategies/equities/spy_momentum/     # symbol_strategy_type

# ❌ BAD - Non-standard naming
strategies/crypto/BTC-SMA-Cross/      # Uppercase, hyphens
strategies/crypto/btc sma cross/      # Spaces
strategies/crypto/btc_sma_cross_strategy_v2_final/  # Too long
```

## Enforcement

- **File Structure**: Verify all required files present
- **Parameter Externalization**: Check no hardcoded parameters
- **Hypothesis Documentation**: Verify hypothesis.md complete
- **Template Usage**: Ensure strategies use template

## Related Agents

- `.claude/agents/strategy_developer.md` - Strategy development
- `.claude/agents/codebase-architect.md` - Strategy architecture
- `strategies/_template/` - Strategy template directory
