---
description: Configuration management - YAML structure, asset configs, strategy parameters, validation
globs: config/**/*.yaml,strategies/**/parameters.yaml,lib/config/**/*.py
alwaysApply: false
---

# Configuration Management Standards

## Purpose
Define YAML structure standards, configuration loading patterns, validation requirements, and asset/strategy parameter organization.

## YAML Structure Standards

### Global Settings (config/settings.yaml)

```yaml
# ✅ GOOD - Well-structured settings.yaml
capital:
  default_initial: 100000
  currency: USD

backtesting:
  data_frequency: daily
  commission:
    equities_per_share: 0.005
    crypto_percent: 0.001

# ❌ BAD - Flat structure, no organization
default_initial_capital: 100000
data_frequency: daily
```

### Data Sources (config/data_sources.yaml)

```yaml
# ✅ GOOD - Clear source definitions
sources:
  yahoo:
    type: yahoo_finance
    enabled: true
  
  csv:
    type: local_csv
    enabled: true
    base_path: data/processed

# ❌ BAD - Missing structure
yahoo_enabled: true
csv_path: data/processed
```

## Asset Configuration

### Asset YAML Structure (config/assets/*.yaml)

```yaml
# ✅ GOOD - Complete asset definition
BTC-USD:
  symbol: BTC-USD
  name: Bitcoin
  exchange: Composite
  asset_class: crypto
  
  trading:
    calendar: CRYPTO
    min_trade_size: 0.0001
    tick_size: 0.01
    
  costs:
    commission_pct: 0.001
    slippage_pct: 0.0005
  
  data_sources:
    primary: yahoo
    alternatives:
      - binance
      - coinbase

# ❌ BAD - Incomplete or flat structure
BTC-USD:
  symbol: BTC-USD
  commission: 0.001
  # Missing trading parameters, calendar, etc.
```

### Asset Class Organization

```python
# ✅ GOOD - Load asset config by class
from lib.config.assets import load_asset_config

crypto_config = load_asset_config('crypto')
btc_config = crypto_config['BTC-USD']

# ❌ BAD - Direct YAML loading
import yaml
with open('config/assets/crypto.yaml') as f:
    config = yaml.load(f)  # Should use load_asset_config()!
```

## Strategy Parameters

### Parameters YAML (strategies/*/parameters.yaml)

```yaml
# ✅ GOOD - Strategy parameters structure
strategy:
  name: btc_sma_cross
  asset_class: crypto
  
parameters:
  symbol: BTC-USD
  fast_period: 10
  slow_period: 50
  threshold: 0.02
  
backtest:
  start_date: "2023-01-01"
  end_date: "2024-06-01"
  capital: 100000

# ❌ BAD - Flat or missing structure
symbol: BTC-USD
fast_period: 10
slow_period: 50
# No organization, missing strategy metadata!
```

### Parameter Loading

```python
# ✅ GOOD - Use lib/config/strategy.py
from lib.config.strategy import load_strategy_params

params = load_strategy_params('btc_sma_cross')
symbol = params['parameters']['symbol']

# ❌ BAD - Direct YAML loading
import yaml
with open('strategies/crypto/btc_sma_cross/parameters.yaml') as f:
    params = yaml.load(f)  # Should use load_strategy_params()!
```

## Configuration Loading

### Use lib/config/ Modules
Always use centralized config loading functions.

```python
# ✅ GOOD - Use config loading functions
from lib.config.core import load_settings
from lib.config.assets import load_asset_config
from lib.config.strategy import load_strategy_params

settings = load_settings()
crypto_config = load_asset_config('crypto')
strategy_params = load_strategy_params('btc_sma_cross')

# ❌ BAD - Direct file access
import yaml
from pathlib import Path

settings_path = Path('config/settings.yaml')
with open(settings_path) as f:
    settings = yaml.load(f)  # Should use load_settings()!
```

### Configuration Caching

```python
# ✅ GOOD - Use cached loading (automatic)
settings = load_settings()  # Cached after first call

# ❌ BAD - Manual caching
_settings_cache = {}
# Don't implement your own cache - use lib/config/!
```

## Configuration Validation

### Validate Strategy Parameters

```python
# ✅ GOOD - Validate before use
from lib.config.strategy import load_strategy_params, validate_strategy_params

params = load_strategy_params('btc_sma_cross')
validate_strategy_params(params)  # Raises ValidationError if invalid

# ❌ BAD - No validation
params = load_strategy_params('btc_sma_cross')
symbol = params['symbol']  # May fail if structure wrong!
```

### Required Fields

```python
# ✅ GOOD - Check required fields
required = ['symbol', 'fast_period', 'slow_period']
missing = [k for k in required if k not in params['parameters']]
if missing:
    raise ValidationError(f"Missing parameters: {missing}")

# ❌ BAD - Assume fields exist
symbol = params['parameters']['symbol']  # May raise KeyError!
```

## Enforcement

- **Structure Validation**: Verify YAML structure matches standards
- **Loading Patterns**: Check use of lib/config/ functions
- **Parameter Validation**: Ensure validation before use

## Related Agents

- `.claude/agents/codebase-architect.md` - Config architecture
- `.claude/agents/strategy_developer.md` - Strategy parameters
