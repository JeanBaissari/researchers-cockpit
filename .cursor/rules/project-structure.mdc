---
description: Directory organization - strategy structure, results naming, symlink conventions
globs: strategies/**/*,results/**/*,config/**/*
alwaysApply: false
---

# Project Structure Standards

## Purpose
Define directory organization, naming conventions, and path resolution patterns for consistent project structure across all components.

## Strategy Directory Structure

### Required Files
Each strategy must have these files:

```
strategies/{asset_class}/{strategy_name}/
├── strategy.py          # REQUIRED: Strategy implementation
├── hypothesis.md        # REQUIRED: Hypothesis documentation
└── parameters.yaml      # REQUIRED: Strategy parameters
```

```python
# ✅ GOOD - Complete strategy structure
strategies/crypto/btc_sma_cross/
├── strategy.py
├── hypothesis.md
└── parameters.yaml

# ❌ BAD - Missing required files
strategies/crypto/btc_sma_cross/
└── strategy.py  # Missing hypothesis.md and parameters.yaml!
```

### Strategy File Organization

```python
# ✅ GOOD - Use template structure
# strategies/_template/strategy.py
from zipline.api import order, symbol, schedule_function
from lib.config.strategy import load_strategy_params

def initialize(context):
    params = load_strategy_params('btc_sma_cross')
    context.asset = symbol(params['symbol'])
    # ... strategy setup

# ❌ BAD - Hardcoded parameters
def initialize(context):
    context.asset = symbol('BTC')  # Should load from parameters.yaml!
    context.fast_period = 10  # Should load from parameters.yaml!
```

## Results Directory Naming

### Timestamp Convention
Use format: `{prefix}_YYYYMMDD_HHMMSS`

```python
# ✅ GOOD - Timestamped result directories
results/btc_sma_cross/
├── backtest_20241220_143022/
│   ├── metrics.json
│   ├── equity_curve.png
│   └── trades.csv
└── latest -> backtest_20241220_143022/

# ❌ BAD - Non-standard naming
results/btc_sma_cross/
├── backtest_1/  # No timestamp!
├── results_new/  # Inconsistent naming!
└── latest/       # Not a symlink!
```

### Result Directory Creation

```python
# ✅ GOOD - Use lib/utils.timestamp_dir()
from lib.utils import timestamp_dir, get_results_dir

result_dir = timestamp_dir(
    get_results_dir() / 'btc_sma_cross',
    prefix='backtest'
)
# Creates: results/btc_sma_cross/backtest_20241220_143022/

# ❌ BAD - Manual timestamp creation
import datetime
timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
result_dir = Path(f"results/btc_sma_cross/backtest_{timestamp}")
# Should use timestamp_dir() utility!
```

## Symlink Conventions

### Latest Symlink Pattern
Always create `latest` symlink pointing to most recent result.

```python
# ✅ GOOD - Update symlink after saving results
from lib.utils import update_symlink

result_dir = timestamp_dir(base_path, 'backtest')
# ... save results to result_dir ...
update_symlink(result_dir, base_path / 'latest')

# ❌ BAD - No symlink management
result_dir = timestamp_dir(base_path, 'backtest')
# ... save results ...
# Missing symlink update!
```

### Symlink Location
Symlinks live in strategy-specific results directories.

```
results/{strategy_name}/
├── backtest_20241220_143022/
└── latest -> backtest_20241220_143022/
```

## Path Resolution

### Use lib/paths.py
Always use path utilities, never hardcode paths.

```python
# ✅ GOOD - Use path utilities
from lib.paths import (
    get_project_root,
    get_strategies_dir,
    get_results_dir,
    get_data_dir
)

strategy_path = get_strategies_dir() / 'crypto' / 'btc_sma_cross'
results_path = get_results_dir() / 'btc_sma_cross'

# ❌ BAD - Hardcoded paths
strategy_path = Path('/home/user/project/strategies/crypto/btc_sma_cross')
# Hardcoded! Use get_strategies_dir() instead!
```

### Project Root Discovery

```python
# ✅ GOOD - Use get_project_root()
from lib.paths import get_project_root

root = get_project_root()
config_path = root / 'config' / 'settings.yaml'

# ❌ BAD - Relative paths or hardcoded roots
config_path = Path('../../config/settings.yaml')  # Fragile!
config_path = Path('/home/user/project/config/settings.yaml')  # Hardcoded!
```

## Configuration File Organization

### Config Directory Structure

```
config/
├── settings.yaml           # Global settings
├── data_sources.yaml       # Data source definitions
└── assets/
    ├── equities.yaml       # Equity asset configs
    ├── crypto.yaml         # Crypto asset configs
    └── forex.yaml          # Forex asset configs
```

```python
# ✅ GOOD - Load from config directory
from lib.config.core import load_settings
from lib.config.assets import load_asset_config

settings = load_settings()
crypto_config = load_asset_config('crypto')

# ❌ BAD - Hardcoded config paths
with open('/home/user/project/config/settings.yaml') as f:
    settings = yaml.load(f)  # Hardcoded path!
```

## Enforcement

- **Structure Validation**: Use `lib.paths.validate_project_structure()`
- **Path Checks**: Verify no hardcoded paths in code
- **Symlink Verification**: Ensure `latest` symlinks exist
- **File Presence**: Check required strategy files exist

## Related Agents

- `.claude/agents/codebase-architect.md` - Architectural validation
- `.claude/agents/strategy_developer.md` - Strategy structure
- `.claude/agents/backtest_runner.md` - Results management
